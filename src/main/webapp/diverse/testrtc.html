
<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <script type="text/javascript">
      var SUPPORTED_URL = "http://localhost:8080/WebRWin/webrw.html";
      var UNSUPPORTED_URL = "http://localhost:8080/WebRWin/unsupportedrtc.html";


      function selectTechnologyLocation() {
        var isWebRTCSupported = window.RTCPeerConnection;
        /*
        var isWebRTCSupported = navigator.getUserMedia ||
          navigator.webkitGetUserMedia ||
          navigator.mozGetUserMedia ||
          navigator.msGetUserMedia ||
          window.RTCPeerConnection;
          */
        /*
         if (window.navigator.userAgent.indexOf("Edge") > -1) {
         //return UNSUPPORTED_URL;
         alert('RTC in Edge nicht supported');
         }
         */

        if (isWebRTCSupported) {
          //return SUPPORTED_URL;
          alert('RTC supported');
        } else {
          //return UNSUPPORTED_URL;
          alert('RTC nicht supported');
        }
      }
      //window.location = selectTechnologyLocation();
      selectTechnologyLocation();

      /**
       * Get the user IP throught the webkitRTCPeerConnection
       * @param onNewIP {Function} listener function to expose the IP locally
       * @return undefined
       * 
       */

      function getUserIP(onNewIP) { //  onNewIp - your listener function for new IPs
        //compatibility for firefox and chrome
        console.log('getUserIP()');

        var myPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
        var pc = new myPeerConnection({
          iceServers: []
        }),
          noop = function () {},
          localIPs = {},
          ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,
          key;

        function iterateIP(ip) {
          if (!localIPs[ip])
            onNewIP(ip);
          localIPs[ip] = true;
        }

        //create a bogus data channel
        pc.createDataChannel("");

        // create offer and set local description
        pc.createOffer().then(function (sdp) {
          sdp.sdp.split('\n').forEach(function (line) {
            if (line.indexOf('candidate') < 0)
              return;
            line.match(ipRegex).forEach(iterateIP);
          });

          pc.setLocalDescription(sdp, noop, noop);
        }).catch(function (reason) {
          // An error occurred, so handle the failure to connect
        });

        //listen for candidate events
        pc.onicecandidate = function (ice) {
          if (!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex))
            return;
          ice.candidate.candidate.match(ipRegex).forEach(iterateIP);
        };
      }

      // Usage
      getUserIP(function (ip) {
        alert("Got IP! :" + ip);
      });
    </script>
  </body>
</html>